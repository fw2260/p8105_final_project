---
title: "Analyses"
date: "11/8/2020"
output: html_document
---

This document contains all of our analyses.

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(ggpubr)
library(corrplot)
source("http://www.sthda.com/upload/rquery_cormat.r")
```


```{r message = FALSE, warning = FALSE}
game_df = read_csv("./data/game_2.csv") %>% 
  separate(release_date, into = c("month_day","year"), sep = ",") %>% 
  separate(genre, into = "genre", sep = ",")
```


## 1. User score vs Metascore (vs Sales)?

```{r}
game_df %>% 
  mutate(text_label = str_c("Title: ", title, "\nPublisher: ", publisher)) %>% 
  plot_ly(x = ~meta_score, y = ~user_score, type = "scatter", text = ~text_label)

game_df %>% 
  group_by(genre) %>% 
  mutate(count = n()) %>% 
  filter(count > 3) %>% 
  ggscatter(., x = "meta_score", y = "user_score", add = "reg.line") +
  facet_wrap(~genre) +
  stat_cor(label.x = 3, label.y = 11) +
  stat_regline_equation(label.x = 3, label.y = 10)

game_df %>% 
  group_by(platform) %>% 
  mutate(count = n()) %>% 
  filter(count > 3) %>% 
  ggscatter(., x = "meta_score", y = "user_score", add = "reg.line") +
  facet_wrap(~platform) +
  stat_cor(label.x = 3, label.y = 11) +
  stat_regline_equation(label.x = 3, label.y = 10)

game_df %>% 
  select(meta_score, user_score, total_sale) %>% 
  mutate(user_score = as.numeric(user_score)) %>% 
  rquery.cormat()
```


## 2. Total sales by genre / Distribution of sales by genre

```{r}
game_df %>% 
  group_by(genre) %>% 
  mutate(count = n(),
         genre = str_c(genre, " (n=", count, ")")) %>%  
  ungroup() %>% 
  mutate(genre = fct_reorder(genre, total_sale),
         text_label = str_c("Title: ", title, "\nPublisher: ", publisher)) %>% 
  plot_ly(x = ~total_sale, color = ~genre, type = "box", colors = "viridis", text = ~text_label)

```


## 3. Which time period generated the most popular games?
let's define popular games as total sales >= 3.5
```{r warning = F, message = F}
game_df %>%
  filter(total_sale >= 3.5) %>%
  mutate(year = as.numeric(year)) %>%
  mutate(period = case_when(year >= '1996'& year <= '1999' ~ '1996-1999',
                            year >= '2000'& year <= '2003' ~ '2000-2003',
                            year >= '2004'& year <= '2006' ~ '2004-2006',
                            year >= '2007'& year <= '2009' ~ '2007-2009',
                            year >= '2010'& year <= '2012' ~ '2010-2012',
                            year >= '2013'& year <= '2015' ~ '2013-2015',
                            year >= '2016'& year <= '2018' ~ '2016-2018'),
         period = as.factor(period)) %>%
  group_by(period) %>%
  summarize(number = n()) %>%
  ungroup() %>%
  plot_ly(x = ~period, y = ~number, type = 'bar', colors = "viridis") 

game_df %>%
  filter(total_sale >= 3.5) %>%
  mutate(year = as.numeric(year)) %>%
  mutate(period = case_when(year >= '1996'& year <= '1999' ~ '1996-1999',
                            year >= '2000'& year <= '2003' ~ '2000-2003',
                            year >= '2004'& year <= '2006' ~ '2004-2006',
                            year >= '2007'& year <= '2009' ~ '2007-2009',
                            year >= '2010'& year <= '2012' ~ '2010-2012',
                            year >= '2013'& year <= '2015' ~ '2013-2015',
                            year >= '2016'& year <= '2018' ~ '2016-2018'),
         period = as.factor(period)) %>%
  mutate(text_label = str_c("Title: ", title,' Total_sale:',total_sale)) %>%
  plot_ly(x = ~period, y = ~total_sale, type = 'scatter', colors = "viridis", color = ~title, text = ~text_label, showlegend = F) 
```


## 4. Which developers released the most/least popular games or the highest/lowest scored?

```{r}

```


## 5. Preference of users of different platform

```{r}

```


## 6. Preference of users from different regions

```{r}

```


## 7. What factors influence sales? How do they influence it?

```{r}

```

