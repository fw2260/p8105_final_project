---
title: "Final Report"
date: "11/23/2020"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

<style type="text/css">

h1.title {
  font-size: 40px;
  font-family: 'Abel', sans-serif;
  color: #003399;
}
h1 { /* Header 1 */
  font-size: 36px;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 30px;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 22px;
  color: DarkBlue;
}
h4 {/* Header 4 */
  font-size: 18px;
  color: DarkBlue;
}
</style>

```{r setup, include=FALSE}
library(tidyverse)
library(patchwork)
library(ggpubr)
library(arsenal)
library(multcomp)
library(modelr)
library(mgcv)
library(plotly)



theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

<br>

## Motivation

Video games have been around for decades, providing entertainment for children and adults alike. They have been involved significantly from the early days of computer games and the early versions of Nintendo and Atari. As technology continues to improve, so do video games. Video game creation has become increasingly complicated, and the cost of creating a game to run one of the major consoles has risen with this greater complexity. 

No longer just an entertainment medium, gaming has rapidly become the largest sector in terms of production and marketing. In fact, it is larger than the movie and music industry combined, and it is only growing. It is no surprise that many big companies want to bring revenues from video games. There are currently more than 2.5 billion gamers across the world. [Analysts](https://newzoo.com/insights/articles/global-games-market-reaches-137-9-billion-in-2018-mobile-games-take-half/) reported that in 2019, the gaming business was estimated to be at 152.1 billion in which console was the second fastest-growing segment, only after mobile gaming. It is generally known that the top largest revenue regions were Asia-Pacific, North America, and Western Europe. In this project, we are going to analyze the 2001-2020 global games market per device from Nintendo, Sony, and Microsoft, and learn about the factors that influence their total revenues. 

<br>

## Initial Questions

For games run on consoles developed by Nintendo, Sony and Microsoft, we want to know separately:

* How does the sales of games change over time?

* What is the most popular/profitable game genre on each companies' consoles?

* Is there an association between critic scores and game sales? In which direction?

* Does the number of consoles the games are released on influence their sales?

<br> 

## Data Collection

```{r, include = FALSE}
games_df = read_csv("./data/games.csv")
```

Our dataset is a combination of data scraped from [VGChartz](https://www.vgchartz.com/games/games.php?page=1&results=200&name=&console=&keyword=&publisher=&genre=&order=TotalSales&ownership=Both&boxart=Both&banner=Both&showdeleted=&region=All&goty_year=&developer=&direction=DESC&showtotalsales=1&shownasales=1&showpalsales=1&showjapansales=1&showothersales=1&showpublisher=0&showdeveloper=0&showreleasedate=0&showlastupdate=0&showvgchartzscore=0&showcriticscore=0&showuserscore=0&showshipped=0&alphasort=&showmultiplat=No), a reliable video game sales tracking website, and [Metacritic](https://www.metacritic.com/browse/games/score/metascore/year/all/filtered?year_selected=2020&distribution=&sort=desc&view=detailed), a well-known review aggregate site for video games. Some information of our dataset comes from VGChartz while others come from Metacritic. Based on the raw dataset, we also created some other new columns.

The key steps for data cleaning are:

* Only keep games run on consoles of Nintendo, Sony or Mircrsoft by `filter`;

* Get `critic_score` from Metacritic using `left_join` method by `title` and `console`;

* Obtain release year from `release_date` using `separate` function;

* Add a new column: `console_developer`, which indicates the developer of the console;

* Add another new column: `n_platforms`, which shows the number of consoles the game runs on.

There are `r nrow(games_df)` rows and `r ncol(games_df)` columns in our final dataset.

Important variables include:

* `title`: unique title of each game

* `console`: platform on which the game was released or is playable (i.e. Switch, PS4, etc.)

* `console_developer`: company produces the consoles

* `n_platforms`: number of platforms per game title

* `genre`: genre of the game 

* `release_year`: year of the game's release

* `critic_score`: Aggregate score compiled by the websites

* `total_sale`: global revenues (millions $) the game earned on one platform

The first ten rows of the dataset is as follow:

```{r}
head(games_df) %>% 
  knitr::kable(format = "html", col.names = colnames(games_df), align="c") %>%
  kableExtra::kable_styling("striped", "hover", row_label_position = "c") %>%
  kableExtra::scroll_box(width = "100%", height = "200px")
```

<br>

## Exploratory Analyses

### Global sales and Number of games released across the years{.tabset}

#### All Consoles

```{r q1, message=FALSE, warning=FALSE}
totalsale = games_df %>% 
  group_by(release_year) %>% 
  summarize(
    totalsale = sum(total_sale)
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = totalsale)) +
  geom_col(color = "navyblue", fill = "white") +
  labs(x = "Year", y = "Total Sale (million USD)")

totalsale_plotly = ggplotly(totalsale)

totalcount = games_df %>% 
 group_by(release_year) %>% 
  summarize(
    count = n()
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = count)) +
  geom_col(color = "darkred", fill = "white") +
  labs(x = "Year", y = "Number of Games")

totalcount_plotly = ggplotly(totalcount)

subplot(totalsale_plotly, totalcount_plotly, titleX = TRUE, titleY = TRUE, margin = 0.1)

```

The left bar graphs showed the cumulative global revenues (in millions USD) of video games released between 2001 and 2020 on the three companies' platforms, and the right one showed the number of video games released on these platforms in the same period. 

Video game industry increased at a rapid rate after 2001 with drastic increase in number of game released each year and the high volume reached its peak in 2008, with 620 games published on these major platforms. Presently, games generating the biggest revenue are also those released in 2008, like Grand Theft Auto IV on Xbox 360. 

Cumulative sales for games which came after 2008 decreased over year. It's quite intuitive because they are younger than their predecessor. And also, as the hardware lifecycle progressed, the sales of games went down. Also, there was a drop in the number of games released on these major consoles after 2008. Maybe that's because nowadays, hardware makers are not eager to release new models every five years, which also decreased the number of games published each year. In addition, noticing there is drastic drop for both sales and number of games after 2018. The number of game release from the three giants in 2019 is only 18 and that in 2020 is 5, which is not the case. We consider data in 2019 and 2020 as inaccurate and exclude them in our further analyses.

<br>

#### Nintendo

```{r, message=FALSE, warning=FALSE}
totalsale = games_df %>% 
  filter(console_developer == "Nintendo") %>% 
  group_by(release_year) %>% 
  summarize(
    totalsale = sum(total_sale)
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = totalsale)) +
  geom_col(color = "navyblue", fill = "white") +
  labs(x = "Year", y = "Total Sale (million USD)")

totalsale_plotly = ggplotly(totalsale)

totalcount = games_df %>% 
 group_by(release_year) %>% 
  summarize(
    count = n()
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = count)) +
  geom_col(color = "darkred", fill = "white") +
  labs(x = "Year", y = "Number of Games")

totalcount_plotly = ggplotly(totalcount)

subplot(totalsale_plotly, totalcount_plotly, titleX = TRUE, titleY = TRUE, margin = 0.1)

```

We can see a similar trend for **Nintendo** and **Microsoft**. 

#### Microsoft

```{r, message=FALSE, warning=FALSE}
totalsale = games_df %>% 
  filter(console_developer == "Microsoft") %>% 
  group_by(release_year) %>% 
  summarize(
    totalsale = sum(total_sale)
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = totalsale)) +
  geom_col(color = "navyblue", fill = "white") +
  labs(x = "Year", y = "Total Sale (million USD)")

totalsale_plotly = ggplotly(totalsale)

totalcount = games_df %>% 
 group_by(release_year) %>% 
  summarize(
    count = n()
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = count)) +
  geom_col(color = "darkred", fill = "white") +
  labs(x = "Year", y = "Number of Games")

totalcount_plotly = ggplotly(totalcount)

subplot(totalsale_plotly, totalcount_plotly, titleX = TRUE, titleY = TRUE, margin = 0.1)

```

We can see a similar trend for **Nintendo** and **Microsoft**.

#### Sony

```{r, message=FALSE, warning=FALSE}
totalsale = games_df %>% 
  filter(console_developer == "Sony") %>% 
  group_by(release_year) %>% 
  summarize(
    totalsale = sum(total_sale)
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = totalsale)) +
  geom_col(color = "navyblue", fill = "white") +
  labs(x = "Year", y = "Total Sale (million USD)")

totalsale_plotly = ggplotly(totalsale)

totalcount = games_df %>% 
 group_by(release_year) %>% 
  summarize(
    count = n()
  ) %>% 
  drop_na() %>% 
  ggplot(aes(x = release_year, y = count)) +
  geom_col(color = "darkred", fill = "white") +
  labs(x = "Year", y = "Number of Games")

totalcount_plotly = ggplotly(totalcount)

subplot(totalsale_plotly, totalcount_plotly, titleX = TRUE, titleY = TRUE, margin = 0.1)

```

However, for **Sony**, it's a different story. The cumulative sales for games released after 2001 kept decreasing, so as the number.

### Global sales of games per genre

```{r q2, message=FALSE, warning=FALSE}
genre_sale_plot = 
  games_df %>% 
  group_by(console_developer, genre) %>% 
  summarise(
    sum_sale = sum(total_sale)
  ) %>% 
  mutate(
    genre = fct_reorder(genre, sum_sale)
  ) %>% 
  ggplot(aes(x = genre, y = sum_sale, fill = console_developer)) +
  geom_bar(stat = "identity", alpha = .7) +
  theme(
    axis.text.x = element_text(angle = 70, vjust = 0.5, hjust = 1, size = 8),
    legend.position = "bottom",
    legend.text = element_text(size = 8)) +
  labs(x = "Genre", y = "Total Sale (million USD)", fill = "Console Developer")

ggplotly(genre_sale_plot) 
```

**Sports** games have been around since the beginning of gaming culture, and it has been one of the most popular genres with their global sales more than 1.0 billion USD. Challenging the player’s reflexes and coordination, **Action** and **Shooting** are the second and third genres in which their total sales are more than 1.84 billion USD. 

The revenues of each company, however, were not the same across the genres. **Nintendo** earned more profits from making games in **sports**, **role-playing**, and **platform**, with each of them brought back more than 290 million USD. **Sony**’s best-selling genre is **action**,which achieved 580.94 million USD revenue between 2001 to 2020. **Sports** and **shooting** also brought huge profits to Sony, with 481.72 and 410.72 million USD respectively. **Microsoft**, despite the latest competitor to enter the video game industry, performs well in **shooting**, **sports**, and **action** genres. The company’s highest revenue was from shooting games with 403.39 million USD.  

<br>

### Relationship between critic score and total revenues

```{r q3, message=FALSE, warning=FALSE}
games_df %>% 
  filter(total_sale < 5) %>% 
  ggplot(aes(x = critic_score, y = total_sale, color = console_developer)) +
  geom_point(alpha = 0.2) +
  geom_smooth(method = 'lm', se = F) +
  labs(x = "Critic Score", y = "Total Sale (million USD)", color = "Console Developer")
```

Critic consensus on a game usually has some correlation with the success of the game in the market in which the critic score can influence the consumer’s decision to buy games.
**Microsoft** and **Sony**'s games usually have scores larger than 5, which means that their games have overall good quality. While for **Nintendo**, some of its games earned low score from the critic. 

As critic score increases, sales of games on the three companies' consoles all increases. What's interesting is that **Sony**'s game sale increases more than the others for one unit increase in critic score and **Nintendo**'s increases the least.

(and **Sony**’s games had the best correlation of the critic score and the total sales, their games overall had the highest scores and the global revenues of approximately more than 1.0 million USD. 
**Microsoft** and **Nintendo**, respectively, are the second and third companies that had lower overall total sales and critic scores relationship. Overall, our data shows that the majority of games with higher scores were produced by **Sony** and thus, having the highest total revenues.)

<br>

### Platform Availability

```{r q4, message=FALSE, warning=FALSE}
platform_available = 
  games_df %>% 
  mutate(n_platforms = as.factor(n_platforms)) %>% 
  ggplot(aes(x = n_platforms, y = log(total_sale), fill = console_developer)) +
  geom_violin(alpha = .5) +
  labs(x = "\nNumber of Platforms", y = "Total Sale Log(million USD)\n") +
  theme_light() +
  facet_wrap(~console_developer,nrow = 3) +
  theme(
    text = element_text(size = 9),
    legend.text = element_text(size = 9),
    axis.title.x = element_text(vjust = -0.5),
    axis.title.y = element_text(vjust = 3.5),
    legend.position = "none"
  )

platform_available
```

Platform availability refers to the number of consoles that the same game is on, and running more consoles indicates higher availability (e.g you can play Grand Theft Auto V on PlayStation 4 and Xbox One at the same time). High availability sometimes euqals to high popularity, which is supposed to bring more sales. However, nonexclusive games won't encourage people to buy certain hardware, since they can play them on products they already have. In this way, the sales brought by the game would be "diluted".

For games of **Microsoft** and **Sony**, the sales improves as the number of console increases overall. And this trend is more apparent for **Sony**. It means that for these two companies, more available games sells better than less available games. While that's not the case for **Nintendo**. Even though there are also nonexclusive games on **Nintendo**'s products, they didn't contributed extra revenue than games with less platform availability. 

(Another factor that has a big impact on how well a game sales is the number of platforms the game is available. Most players do not have multiple consoles and a game that releases on multiple platforms has a much higher potential customer number. The plot showed that there was a large distribution of total revenues in the smaller number of platforms since most players owned only 1 or 2 consoles.)

<br>

## Statistical Analyses

### Anova Test

```{r, message=FALSE, warning=FALSE}
games_df = games_df %>%
   filter(release_year < 2019) %>%
  mutate(
    n_platforms = 
      case_when(n_platforms == '1' ~ 'small',
                n_platforms >= '2' & n_platforms <= '3' ~ 'medium',
                n_platforms >= '4' ~ 'large'),
    n_platforms = as.factor(n_platforms)
    ) %>% 
  dplyr::select(title:genre,critic_score, total_sale)
```
 
By Analysis of Variance (ANOVA) we can conduct comparisons among groups of our interested categorical variables : n_platforms. We further divided n_platform into 3 groups: `small` (`n_platforms` = 1), `medium` (2 <= `n_platforms` <= 3) and `large` (4 <= `n_platforms` <= 9). 
    
### 1. One-way ANOVA: Total_sale ~ n_platforms 

```{r ANOVA_Genre, message=FALSE, warning=FALSE}
aov_mod_1 = aov(total_sale ~ n_platforms, data = games_df)
```
```{r }
broom::tidy(aov_mod_1)
```
```{r }
multi_comp_1 = TukeyHSD(aov_mod_1)
plot(multi_comp_1)
```

With p.value < 0.001, we conclude that at least two of the n_platforms groups have different average total_sales. Then Tukey's method was performed to make pairwise comparisons.All comparisons have significant differences in mean of total_sale.

### 2. Conclusion

ANOVA test above provides evidence that there are true differences in games sales among different groups of n_platforms.Therefore, we include console_developer, n_platforms, critic_score as predictors in our linear regression model 

Similarly, we conducted ANOVA test for different levels of genre and concluded that there are true difference in global sales among different genres.
<br>

### Linear Regression

```{r regression dataset, message=FALSE, warning=FALSE}
regression_df = 
  games_df %>%
  filter(total_sale < 5) # cutoff outliers
```


### 1. Build Models

Model 1:  total_sale ~ console_developer * genre + console_developer * n_platforms.

Model 2:  total_sale ~ console_developer * genre + console_developer * n_platforms + console_developer * critic_score

Model 3:  total_sale ~ console_developer * genre + console_developer * critic_score

Model 4:  total_sale ~ console_developer * n_platforms + console_developer * critic_score

Model 2 contains console_developer and all other interested predictors (genre, n_platform, critic_score), as well as interactions. While Model 1,3,4 contain console_developer and only two of interested predictors and their interactions. 

<br>

### 2. Cross validation

We use `crossv_mc` method to create training and testing datasets and fit the above 4 candidate models. The violin plots below shows the distribution of **RMSE** values for each model:


```{r regression_rmse_1,warning = F ,include = F}
cv_df = 
  crossv_mc(regression_df, 300) %>% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)
  )
  
  
cv_df = 
  cv_df %>% 
  mutate(
    linear_1 = map(.x = train, ~lm(total_sale ~ console_developer*genre + console_developer*n_platforms, data = .x)),
    linear_2 = map(.x = train, ~lm(total_sale ~ console_developer*genre + console_developer*n_platforms + console_developer*critic_score, data = .x)),
    linear_3 = map(.x = train, ~lm(total_sale ~ console_developer*genre + console_developer*critic_score, data = .x)),
    linear_4 = map(.x = train, ~lm(total_sale ~ console_developer*n_platforms + console_developer*critic_score, data = .x))
  ) %>% 
  mutate(
    rmse_1 = map2_dbl(.x = linear_1, .y = test, ~rmse(model = .x, data = .y)),
    rmse_2 = map2_dbl(.x = linear_2, .y = test, ~rmse(model = .x, data = .y)),
    rmse_3 = map2_dbl(.x = linear_3, .y = test, ~rmse(model = .x, data = .y)),
    rmse_4 = map2_dbl(.x = linear_4, .y = test, ~rmse(model = .x, data = .y))
  )
```


```{r regression_rmse_compare1234,warning = F ,message = F}
cv_df %>% 
  dplyr::select(starts_with("rmse")) %>% 
  pivot_longer(
    everything(),
    names_to = "model",
    values_to = "rmse",
    names_prefix = "rmse_"
  ) %>% 
  ggplot(aes(x = model, y = rmse)) +
  geom_violin()
```

Based on the results, Model 2 has the lowest **RMSE**, but **RMSE** of model 3 and 4 is just slightly higher than Model 2, which indictes that there's minor improvement for adding `console_developer*critic_score` as an additional predictor. Also, there are 6 subgroups in `genre`, which makes Model 3 more hard to interpret than Model 4. In this way, we decide to select **Model 4** as our final model.

<br>

### 3. Diagnosis

In **Model 4**, we used **Residuals vs Fitted Values** plot to detect unequal error variance (heteroscedasticity) and outliers. 

```{r, message = FALSE}
lm4 = lm(total_sale ~ console_developer*n_platforms + console_developer*critic_score, data = regression_df)

regression_df %>%
  add_predictions(lm4) %>%
  add_residuals(lm4) %>%
  ggplot(aes(x = pred, y = resid))+ 
  geom_point(alpha = 0.3)+
  geom_smooth(method = 'lm', color = 'red')+
  labs(x = 'fitted values of total_sales', y = 'model residuals', title = 'Residuals vs Fitted Values')
```
  
As shown in the graph, there are many outliers with residuals > 3. Although the mean of residual values is close to 0 and residuals have a horizontal relationship with fitted value, the distribution of residual values is skewed. This plot indicates that our model does not have ideally distributed residuals.

### 4. Results

The summary of the selected model: latex is as follow:

```{r}
coe_df = broom::tidy(lm4) 

coe_df_tidy = 
  coe_df %>%
  select(term, estimate, p.value) %>% 
  mutate(
    term = str_replace(term, "^console_developer:", "Developer: "),
    term = str_replace(term, "^n_platforms:", "Num_Consoles: "),
  ) %>%
  knitr::kable(digits = 3)

coe_df_tidy
```



<br>

## Findings

* From the analysis above, **2008** is the year with the **highest global revenues** and the **most games released**. After 2012, in general ,there was a slight decrease in both the number of games released and total revenues for the three big companies: Nintendo, Sony, and Microsoft. 

* **Action**, **sports**, and **shooting** are the most popular and the genres that bring the most profits to the gaming companies. 

* It seems that as the critic scores increase, there is a general associated increase in the globlal sales. **Sony** was the company in which their games had the highest critic score and highest global sales. 

* Another factor that also impacts how well a game sales is the number of platforms the game is available. Most gamers do not have multiple consoles and a game that releases on multiple platforms has a much higher potential customer number, thus higher sales. 

<br>

## Discussion
